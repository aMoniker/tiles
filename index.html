<!doctype html>

<html>
<head>
    <script src="Base.js"></script>
    <script src="Bind.js"></script>
    <script src="jquery-1.8.0.min.js"></script>
    <script src="jq.pubsub.js"></script>
    <script src="canvas.js"></script>
    <link rel="stylesheet" type="text/css" href="stylin.css">
</head>
<body>
    <div id="content">
        <canvas id="a_tile" width="250" height="250">Your browser can't render canvas :(</canvas>
        <div id="the_colors">
            <div class="color slate selected"></div>
            <div class="color pacifica"></div>
            <div class="color apple"></div>
            <div class="color reflector"></div>
            <div class="color pillow"></div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function() {
            var $canvas = $('#a_tile');
            $.publish('Canvas.set_canvas', [$canvas]);

            var ink_flow = false;
            var last_position = {};

            $canvas.on('mousedown', function(e) {
                e.originalEvent.preventDefault(); // prevent I cursor while draggin
                ink_flow = true;
            });
            $(document).on('mouseup', function() { ink_flow = false; });

            $(document).on('mousemove', function(e) {
                last_position.x = e.clientX - $canvas.offset().left;
                last_position.y = e.clientY - $canvas.offset().top;
            });

            $canvas.on('mousemove mouseout', function(e) {
                if (!ink_flow || !last_position) { return; }
                $.publish('Canvas.draw_line', [last_position.x, last_position.y, e.offsetX, e.offsetY]);
            });

            $('#the_colors .color').on('click', function() {
                var $this = $(this);
                $this.siblings().removeClass('selected');
                $this.addClass('selected');
                $.publish('Canvas.set_color', [$this.css('background-color')]);
            });
        });
    </script>
<body>
</html>